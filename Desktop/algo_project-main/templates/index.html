<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØºØ§Ø±Ø© Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø³Ø­Ø±ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root { 
            --primary: #FF6B6B; 
            --secondary: #4ECDC4; 
            --accent: #FFE66D; 
            --dark: #2F2E41; 
            --purple: #a855f7; 
            --blue: #3b82f6;
        }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background: #f0f9ff; 
            background-image: radial-gradient(#dcfce7 1px, transparent 1px); 
            background-size: 20px 20px;
            margin: 0; padding: 20px; color: var(--dark); overflow-x: hidden;
        }

        .game-header { text-align: center; margin-bottom: 40px; }
        .game-header h1 { font-size: 3.5rem; color: var(--primary); text-shadow: 4px 4px 0px white; margin-bottom: 5px; font-weight: 900; }
        
        nav { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
        nav a { 
            text-decoration: none; padding: 15px 30px; border-radius: 50px; 
            background: white; color: var(--dark); font-weight: bold; 
            box-shadow: 0 6px 0px #ddd; transition: 0.3s;
        }
        nav a:hover { transform: translateY(-3px); box-shadow: 0 9px 0px #ddd; background: var(--accent); }

        .mission-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 25px; max-width: 1200px; margin: 0 auto; 
        }

        .mission-card { 
            background: rgba(255, 255, 255, 0.95); border-radius: 30px; padding: 30px; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.05); border: 4px solid transparent;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative;
        }
        .mission-card:hover { transform: translateY(-10px); border-color: var(--secondary); }
        .mission-card h2 { margin-top: 0; font-size: 1.8rem; display: flex; align-items: center; gap: 10px; color: var(--purple); }

        .magic-input { 
            width: 100%; border: 3px solid #eee; border-radius: 20px; padding: 15px; 
            font-size: 1.2rem; outline: none; transition: 0.3s; margin-bottom: 12px; box-sizing: border-box;
            text-align: center; font-weight: bold;
        }
        .magic-input:focus { border-color: var(--primary); background: #fffdf0; }

        .magic-btn { 
            width: 100%; padding: 18px; border: none; border-radius: 20px; 
            color: white; font-weight: bold; font-size: 1.3rem; cursor: pointer;
            box-shadow: 0 8px 0px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .magic-btn:active { transform: translateY(4px); box-shadow: none; }

        .scroll-box { margin-top: 20px; max-height: 250px; overflow-y: auto; border-radius: 20px; background: #fdfdfd; padding: 10px; border: 2px inset #eee; }
        .result-table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        .result-table td { 
            padding: 15px; background: white; border-radius: 15px; 
            text-align: center; cursor: pointer; border: 2px solid #f0f0f0; transition: 0.2s;
            position: relative;
        }
        .result-table td:hover { background: var(--accent); border-color: #f59e0b; }
        .result-table td::after { content: 'ğŸ”Š'; position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 1rem; opacity: 0.5; }

        .analysis-root { 
            color: var(--secondary); font-size: 1.1rem; font-weight: bold; 
            margin-top: 8px; border-top: 1px dashed #ddd; padding-top: 8px;
        }

        .color-purple { border-bottom: 10px solid var(--purple); }
        .color-green { border-bottom: 10px solid var(--secondary); }
        .color-yellow { border-bottom: 10px solid #f59e0b; }
        .color-red { border-bottom: 10px solid var(--primary); }
        .color-blue { border-bottom: 10px solid var(--blue); }
    </style>
</head>
<body>

    <div class="game-header animate__animated animate__bounceIn">
        <h1>âœ¨ Ù…ØºØ§Ø±Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª âœ¨</h1>
        <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„! Ø§Ø³ØªÙƒØ´Ù Ø³Ø­Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø³Ù…Ø§Ø¹Ù‡Ø§.</p>
    </div>

    <nav>
        <a href="/view_roots">ğŸŒ³ ØºØ§Ø¨Ø© Ø§Ù„Ø¬Ø°ÙˆØ±</a>
        <a href="/view_schemes">ğŸ“œ ÙƒØªØ§Ø¨ Ø§Ù„Ø£ÙˆØ²Ø§Ù†</a>
    </nav>

    <div class="mission-grid">
        <div class="mission-card color-purple animate__animated animate__zoomIn">
            <h2>ğŸ•µï¸ Ù…Ø¬Ù‡Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h2>
            <input type="text" id="iWord" class="magic-input" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù‡Ù†Ø§">
            <button class="magic-btn" style="background: var(--purple);" onclick="api('/identify', {word: v('iWord')}, 'resId')">Ø­Ù„Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©</button>
            <div id="resId" class="scroll-box"></div>
        </div>

        <div class="mission-card color-yellow animate__animated animate__zoomIn" style="animation-delay: 0.1s;">
            <h2>ğŸª„ Ø¹ØµØ§ Ø§Ù„Ø§Ø´ØªÙ‚Ø§Ù‚</h2>
            <input type="text" id="rGen" class="magic-input" placeholder="3 Ø­Ø±ÙˆÙ (Ù…Ø«Ù„Ø§Ù‹: ÙƒØªØ¨)">
            <button class="magic-btn" style="background: #f59e0b;" onclick="api('/generate_all', {root: v('rGen')}, 'resGen')">Ø§Ø´ØªÙ‚ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
            <div id="resGen" class="scroll-box"></div>
        </div>

        <div class="mission-card color-green animate__animated animate__zoomIn" style="animation-delay: 0.2s;">
            <h2>âœ… Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©</h2>
            <input type="text" id="vWord" class="magic-input" placeholder="Ø§Ù„ÙƒÙ„Ù…Ø© (Ù…ÙƒØªÙˆØ¨)">
            <input type="text" id="vRoot" class="magic-input" placeholder="Ø§Ù„Ø¬Ø°Ø± (ÙƒØªØ¨)">
            <button class="magic-btn" style="background: var(--secondary);" onclick="api('/verify', {word: v('vWord'), root: v('vRoot')}, 'resV')">ØªØ­Ù‚Ù‚ ÙˆÙ…Ø²Ø§Ù…Ù†Ø©</button>
            <div id="resV" class="scroll-box"></div>
        </div>

        <div class="mission-card color-red animate__animated animate__zoomIn" style="animation-delay: 0.3s;">
            <h2>âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø°ÙˆØ±</h2>
            <input type="text" id="mRoot" class="magic-input" placeholder="3 Ø­Ø±ÙˆÙ">
            <div style="display: flex; gap: 10px;">
                <button class="magic-btn" style="background: var(--secondary);" onclick="api('/manage', {root: v('mRoot'), action:'add'})">Ø¥Ø¶Ø§ÙØ©</button>
                <button class="magic-btn" style="background: var(--primary);" onclick="api('/manage', {root: v('mRoot'), action:'delete'})">Ø­Ø°Ù</button>
            </div>
        </div>

        <!-- NOUVELLE SECTION : Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙˆØ²Ø§Ù† -->
        <div class="mission-card color-blue animate__animated animate__zoomIn" style="animation-delay: 0.4s;">
            <h2>ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙˆØ²Ø§Ù†</h2>
            <input type="text" id="newScheme" class="magic-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙˆØ²Ù† (Ù…Ø«Ø§Ù„: Ù…ÙØ§Ø¹Ù„)">
            <input type="text" id="schemeCat" class="magic-input" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <div style="display: flex; gap: 10px; margin-top: 12px;">
                <button class="magic-btn" style="background: var(--blue);" onclick="manageScheme('add')">Ø¥Ø¶Ø§ÙØ© ÙˆØ²Ù†</button>
                <button class="magic-btn" style="background: #ef4444;" onclick="manageScheme('delete')">Ø­Ø°Ù ÙˆØ²Ù†</button>
            </div>
            <div id="resScheme" class="scroll-box" style="margin-top: 15px;"></div>
        </div>
    </div>

    <script>
        const v = (id) => document.getElementById(id).value;

        function speakClean(word, scheme) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const msg1 = new SpeechSynthesisUtterance(word);
                const msg2 = new SpeechSynthesisUtterance("Ø¹Ù„Ù‰ ÙˆØ²Ù† " + scheme);
                [msg1, msg2].forEach(m => { m.lang = 'ar-SA'; m.rate = 0.85; });
                window.speechSynthesis.speak(msg1);
                msg1.onend = () => {
                    setTimeout(() => window.speechSynthesis.speak(msg2), 400);
                };
            }
        }

        async function api(path, data, resId) {
            const r = await fetch(path, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)});
            const res = await r.json();
            const box = document.getElementById(resId);
            
            if(res.error) { 
                box.innerHTML = `<p style="color:red; font-weight:bold; padding:10px;">âš ï¸ ${res.error}</p>`; 
                return; 
            }

            if(res.success) { 
                alert("ğŸŒŸ " + res.success); 
                setTimeout(() => location.reload(), 800);
                return; 
            }
            
            if(res.results) {
                let h = '<table class="result-table">';
                res.results.forEach(x => {
                    const word = x.word || x.root;
                    const scheme = x.scheme;
                    const rootVerbe = x.root;
                    h += `<tr onclick="speakClean('${word}', '${scheme}')">
                            <td>
                                <div style="font-size:1.4rem; font-weight:900; color:var(--dark);">${word}</div>
                                <div style="color:var(--purple); font-size:1rem; font-weight:bold;">Ø§Ù„ÙˆØ²Ù†: ${scheme}</div>
                                ${rootVerbe ? `<div class="analysis-root">Ø§Ù„ÙØ¹Ù„ (Ø§Ù„Ø¬Ø°Ø±): ${rootVerbe}</div>` : ''}
                            </td>
                          </tr>`;
                });
                box.innerHTML = h + '</table>';
            } 
            else if(res.message) {
                const isError = res.message.includes("Ù„Ø§ ØªÙ†ØªÙ…ÙŠ");
                const bgColor = isError ? "#fee2e2" : "#dcfce7";
                const textColor = isError ? "#b91c1c" : "#166534";
                const borderColor = isError ? "#ef4444" : "#22c55e";

                box.innerHTML = `<div class="animate__animated animate__shakeX" 
                                     style="background:${bgColor}; padding:15px; border-radius:15px; color:${textColor}; font-weight:bold; border:2px solid ${borderColor}; text-align:center;">
                                     ${isError ? 'âŒ' : 'ğŸŒŸ'} ${res.message}
                                 </div>`;
            }
        }

        // NOUVELLE FONCTION POUR AJOUT / SUPPRESSION DES SCHÃˆMES
        async function manageScheme(action) {
            const name = v('newScheme').trim();
            const category = v('schemeCat').trim() || 'Ø¹Ø§Ù…';

            if (!name) {
                document.getElementById('resScheme').innerHTML = 
                    `<p style="color:red; font-weight:bold; padding:10px;">ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙˆØ²Ù†</p>`;
                return;
            }

            const endpoint = action === 'add' ? '/add_scheme' : '/delete_scheme';
            const data = { name: name, category: category };

            const r = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const res = await r.json();
            const box = document.getElementById('resScheme');

            if (res.success) {
                box.innerHTML = `<div style="background:#dcfce7; padding:12px; border-radius:12px; color:#166534; font-weight:bold; text-align:center;">
                    ğŸŒŸ ${res.success}
                </div>`;
                setTimeout(() => location.reload(), 1200);
            } else if (res.error) {
                box.innerHTML = `<div style="background:#fee2e2; padding:12px; border-radius:12px; color:#b91c1c; font-weight:bold; text-align:center;">
                    âš ï¸ ${res.error}
                </div>`;
            }
        }
    </script>
</body>
</html>